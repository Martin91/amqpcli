#!/usr/bin/env python
# -*- coding: utf-8 -*-

from argparse import ArgumentParser

from lib.app import App
from lib.handler import QueueDeclareHandler
from lib.version import Version

def run_application(broker):
    app = App(broker)
    app.register_handlers(QueueDeclareHandler)
    app.welcome()

    app.event_loop()

def parse_options():
    parser = ArgumentParser(description="An AMQP protocol client")
    parser.add_argument("-b", "--broker", dest="broker", help="the broker url")
    parser.add_argument("-v", "--version", dest="version", action="version", version='%(prog)s v{}'.format(Version))
    return parser.parse_args()


if __name__ == "__main__":
    options = parse_options()
    run_application(options.broker)
